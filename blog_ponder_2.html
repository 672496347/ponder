<!-- HTML header for doxygen 1.8.10-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.18"/>
<title>ponder: Ponder 2.x Release Notes</title>
<link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Slab|Ubuntu+Mono" rel="stylesheet">
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="dox_style.css" rel="stylesheet" type="text/css"/>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-3400898-6"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-3400898-6');
</script>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr>
  <td id="projectalign">
   <div id="projectname">ponder
   <span id="projectnumber">3.2</span>
   </div>
   <div id="projectbrief">C++ reflection library</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.18 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('blog_ponder_2.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Ponder 2.x Release Notes </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#ponder_2_0">2.0 Release Notes</a><ul><li class="level2"><a href="#decoupling">Decoupling</a></li>
<li class="level2"><a href="#renaming_2">Renaming</a></li>
<li class="level2"><a href="#lua_support">Lua binding generator</a></li>
<li class="level2"><a href="#static_funcs">Added support for binding to static functions (issue #46)</a></li>
<li class="level2"><a href="#call_return_policy">Added function call return policies (issue #51)</a></li>
<li class="level2"><a href="#parent_child_removed">Removed UserObject parent-child. Simplification, unused.</a></li>
</ul>
</li>
<li class="level1"><a href="#ponder_2_1">2.1 Release Notes</a><ul><li class="level2"><a href="#lua_binding_improved">Lua: Improved function bindings</a></li>
<li class="level2"><a href="#lua_custom_type_conv">Lua: Custom type conversion</a></li>
<li class="level2"><a href="#lua_table_params">Lua: Table parameters</a></li>
<li class="level2"><a href="#lua_multiple_return">Lua: Multiple return values</a></li>
<li class="level2"><a href="#lua_enums">Lua: Enum support</a></li>
</ul>
</li>
<li class="level1"><a href="#ponder_2_2">2.2 Release Notes</a><ul><li class="level2"><a href="#fmt_removed">fmt library removed</a></li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><dl class="section note"><dt>Note</dt><dd>These a notes for an older API <em>for reference</em>. The details may have changed and therefore the links and code may not work. Make sure you check the latest docs.</dd></dl>
<h1><a class="anchor" id="ponder_2_0"></a>
2.0 Release Notes</h1>
<p><em>date: 2016-09-18</em></p>
<dl class="section note"><dt>Note</dt><dd>Ponder has undergone some significant changes in this release. V1 featured the removal of Boost. Subsequent versions have added more features. V2 is moving towards a different design.</dd></dl>
<h2><a class="anchor" id="decoupling"></a>
Decoupling</h2>
<p>The biggest change is the decoupling of the runtime usage of the declared data. In CAMP/V1 the declared <code>Function</code> contains both the data about the function and the call interface. Additionally it contains controls for the calling, i.e. <code>callable()</code>.</p>
<div class="fragment"><div class="line"><span class="keyword">class </span><a class="code" href="namespaceponder.html#a19b1bfb43a01f887ea5b9845f518cf63a86408593c34af77fdd90df932f8b5261">Function</a>  <span class="comment">// V1</span></div>
<div class="line">{</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> std::string&amp; name() <span class="keyword">const</span>;</div>
<div class="line">    std::size_t argCount() <span class="keyword">const</span>;</div>
<div class="line">    Type returnType() <span class="keyword">const</span>;</div>
<div class="line">    Type argType(std::size_t index) <span class="keyword">const</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">bool</span> callable(<span class="keyword">const</span> UserObject&amp; <span class="keywordtype">object</span>) <span class="keyword">const</span>;</div>
<div class="line">    Value <a class="code" href="namespaceponder_1_1runtime.html#a8524809118ea8407bc73e7cbc06fd358">call</a>(<span class="keyword">const</span> UserObject&amp; <span class="keywordtype">object</span>, <span class="keyword">const</span> Args&amp; args = Args::empty) <span class="keyword">const</span>;</div>
<div class="line"> </div>
<div class="line">    ...</div>
<div class="line">};</div>
</div><!-- fragment --><p>In V2 we are moving towards Function being an immutable data object containing information about the function, but no interface for calling. This has been moved to the "runtime" namespace.</p>
<div class="fragment"><div class="line"><span class="keyword">class </span><a class="code" href="namespaceponder.html#a19b1bfb43a01f887ea5b9845f518cf63a86408593c34af77fdd90df932f8b5261">Function</a>  <span class="comment">// V2</span></div>
<div class="line">{</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line"> </div>
<div class="line">    IdRef name() <span class="keyword">const</span>;</div>
<div class="line">    <a class="code" href="namespaceponder.html#a19b1bfb43a01f887ea5b9845f518cf63">FunctionKind</a> kind() <span class="keyword">const</span>;</div>
<div class="line">    <a class="code" href="namespaceponder.html#a70733c0387bfaf658c5ded607c30d473">ValueKind</a> returnType() <span class="keyword">const</span>;</div>
<div class="line">    policy::ReturnKind returnPolicy() <span class="keyword">const</span>;</div>
<div class="line">    std::size_t paramCount() <span class="keyword">const</span>;</div>
<div class="line">    <a class="code" href="namespaceponder.html#a70733c0387bfaf658c5ded607c30d473">ValueKind</a> paramType(std::size_t index) <span class="keyword">const</span>;</div>
<div class="line"> </div>
<div class="line">};</div>
</div><!-- fragment --><p>In <code><a class="el" href="namespaceponder_1_1runtime.html" title="Contains Ponder runtime support public API.">ponder::runtime</a></code> we now have an <code>ObjectCaller</code>. This retrieves the requested function and allows you to call it. So the use of the <code>Function</code> data is decoupled from the data. This stops the <code>Function</code> data from being polluted with a particular usage of the data.</p>
<div class="fragment"><div class="line"><span class="keyword">class </span>ObjectCaller</div>
<div class="line">{</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    ObjectCaller(<span class="keyword">const</span> Function &amp;fn);</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">template</span> &lt;<span class="keyword">typename</span>... A&gt;</div>
<div class="line">    Value <a class="code" href="namespaceponder_1_1runtime.html#a8524809118ea8407bc73e7cbc06fd358">call</a>(<span class="keyword">const</span> UserObject &amp;obj, A... args);</div>
<div class="line">};</div>
</div><!-- fragment --><h2><a class="anchor" id="renaming_2"></a>
Renaming</h2>
<p>You might notice from the above that several things have been renamed, e.g. arguments are now parameters. In the declaration we declare <em>parameters</em>, i.e. what the function <em>receives</em>. Arguments are what are <em>given</em> to the function when called.</p>
<p>There are also words which have been overloaded, which causes confusion. "Type" can mean a data type, or a group's classification, e.g. <code>int</code> vs integer. Classifications are now "kinds", i.e. a kind of integer. This might seem pedantic but in an API like this type is used extensively! </p><pre class="fragment">enum class ValueKind
{
    None,       // No type has been defined yet
    Boolean,    // Boolean type (bool)
    Integer,    // Integer types (unsigned/signed char short int long)
    Real,       // Real types (float, double)
    String,     // String types (char*, ponder::String)
    Enum,       // Enumerated types
    Array,      // Array types (std::vector, std::list, T[])
    User        // User-defined classes
};

enum class FunctionKind
{
    None,               // not a function
    Function,           // a function
    MemberFunction,     // function in a class or struct
    MemberObject,       // object in a class or struct
    FunctionWrapper,    // `std::function&lt;&gt;`
    BindExpression,     // `std::bind()`
    Lambda              // lambda function `[](){}`
};
</pre><p>Another example is renaming <code>PONDER_RTTI</code> to <code>PONDER_POLYMORPHIC</code> (issue #36). The macro only needs to be added to a user API when we want to support polymorphism.</p>
<h2><a class="anchor" id="lua_support"></a>
Lua binding generator</h2>
<p>A new feature is the Lua binding generator (issue #40). Please note this is still in development at the current time and could change significantly. This can expose a class declaration to Lua so that the functions can be called and the properties can get and set values. More articles to come.</p>
<h2><a class="anchor" id="static_funcs"></a>
Added support for binding to static functions (issue #46)</h2>
<p>We can now add non-member functions to a class declaration. This can be a class static function, or a non-class function.</p>
<h2><a class="anchor" id="call_return_policy"></a>
Added function call return policies (issue #51)</h2>
<p>Declared functions that return values can declare return policies. If a function returns, say, a <code>const</code> reference this is ambiguous. It could either be a reference that will be copied to form a new object, or a reference to an internal object that we want to inspect. We can now use <code><a class="el" href="structponder_1_1policy_1_1_return_copy.html" title="Call return copy policy.">ponder::policy::ReturnCopy</a></code> and <code><a class="el" href="structponder_1_1policy_1_1_return_internal_ref.html" title="Call return internal reference policy.">ponder::policy::ReturnInternalRef</a></code> to choose which one to return. The API will bind the function accordingly.</p>
<h2><a class="anchor" id="parent_child_removed"></a>
Removed UserObject parent-child. Simplification, unused.</h2>
<p><code>UserObject</code>s had a parent-child relationship. I am unsure of the use for this and in complicated the <code>UserObject</code> implementation somewhat so it has been removed.</p>
<h1><a class="anchor" id="ponder_2_1"></a>
2.1 Release Notes</h1>
<p><em>date: 2016-10-12</em></p>
<dl class="section note"><dt>Note</dt><dd>The emphasis was on Lua scripting in this release.</dd></dl>
<h2><a class="anchor" id="lua_binding_improved"></a>
Lua: Improved function bindings</h2>
<p>In the previous release, Ponder used the runtime metaclass function information at runtime to call functions, i.e. runtime introspection. This can be a little inefficient though as the runtime caller requires us to convert arguments to <code><a class="el" href="classponder_1_1_value.html" title="Variant class which is used to wrap values in the Ponder system.">ponder::Value</a></code>s for calling. For example a function accepting a <code>const char*</code> parameter would generate a temporary <code>std::string</code> in a <code><a class="el" href="classponder_1_1_value.html" title="Variant class which is used to wrap values in the Ponder system.">ponder::Value</a></code>, part of <code><a class="el" href="classponder_1_1_args.html" title="Wrapper for packing an arbitrary number of arguments into a single object.">ponder::Args</a></code>, which would be discarded after the call. Returns values were also converted to <code><a class="el" href="classponder_1_1_value.html" title="Variant class which is used to wrap values in the Ponder system.">ponder::Value</a></code>s, which need to be converted back into user types.</p>
<p>This has been made more efficient, and more flexible, by adding a direct Lua binding. Now the Lua API is used directly from the <em>compile-time</em> metadata, so no <code><a class="el" href="classponder_1_1_value.html" title="Variant class which is used to wrap values in the Ponder system.">ponder::Value</a></code> coercion is necessary.</p>
<h2><a class="anchor" id="lua_custom_type_conv"></a>
Lua: Custom type conversion</h2>
<p>This direct binding also means that the Lua function parameters can be customised, so we can convert user types to Lua types, customised per type if necessary. <code>ponder_ext::LuaValueReader</code> is used to read Lua values, and <code>ponder_ext::LuaValueWriter</code> to write back. The <code><a class="el" href="namespaceponder__ext.html" title="Ponder user extendable namespace.">ponder_ext</a></code> namespace is used here to signify that user extensions are allowed.</p>
<h2><a class="anchor" id="lua_table_params"></a>
Lua: Table parameters</h2>
<p>Functions can accept Lua table parameters. <code>ponder_ext::LuaTable</code> can be declared as a function parameter. The binding then expects table to be passed to the declared function and the Lua API can be used to parse the table.</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>TableClass</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> a;</div>
<div class="line">    std::string b;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Function accepting a Lua table. User writes parser.</span></div>
<div class="line">    <span class="keywordtype">void</span> init(ponder_ext::LuaTable lt)</div>
<div class="line">    {</div>
<div class="line">        assert(lua_istable(lt.L, -1)); <span class="comment">// should be guaranteed by conversion</span></div>
<div class="line"> </div>
<div class="line">        lua_getfield(lt.L, -1, <span class="stringliteral">&quot;a&quot;</span>);</div>
<div class="line">        a = luaL_checknumber(lt.L, -1);</div>
<div class="line">        lua_pop(lt.L, 1);</div>
<div class="line"> </div>
<div class="line">        lua_getfield(lt.L, -1, <span class="stringliteral">&quot;b&quot;</span>);</div>
<div class="line">        b = luaL_checkstring(lt.L, -1);</div>
<div class="line">        lua_pop(lt.L, 1);</div>
<div class="line">    }</div>
<div class="line">};</div>
</div><!-- fragment --><p>Declare as normal:</p>
<div class="fragment"><div class="line">ponder::Class::declare&lt;Parsing&gt;()</div>
<div class="line">    .constructor()</div>
<div class="line">    .function(<span class="stringliteral">&quot;init&quot;</span>, &amp;Parsing::init)</div>
<div class="line">    .property(<span class="stringliteral">&quot;a&quot;</span>, &amp;Parsing::a)</div>
<div class="line">    .property(<span class="stringliteral">&quot;b&quot;</span>, &amp;Parsing::b)</div>
<div class="line">    ;</div>
</div><!-- fragment --><p>From Lua: </p><pre class="fragment">p = Parsing()
p:init{a=77, b='some text'}               -- table is passed to user function
assert(p.a == 77 and p.b == 'some text')  -- check values set correctly
</pre><h2><a class="anchor" id="lua_multiple_return"></a>
Lua: Multiple return values</h2>
<p>Declared functions can return multiple values to Lua using tuples. A policy is used to denote this.</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>Vec</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">float</span>   x,y;</div>
<div class="line"> </div>
<div class="line">    Vec() : x(0), y(0) {}</div>
<div class="line">    Vec(<span class="keywordtype">float</span> x_, <span class="keywordtype">float</span> y_) : x(x_), y(y_) {}</div>
<div class="line"> </div>
<div class="line">    std::tuple&lt;float,float&gt; get()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> std::make_tuple(x,y); }</div>
<div class="line">};</div>
</div><!-- fragment --><p>Declare:</p>
<div class="fragment"><div class="line">ponder::Class::declare&lt;Vec&gt;()</div>
<div class="line">    .constructor()</div>
<div class="line">    .constructor&lt;float, <span class="keywordtype">float</span>&gt;()</div>
<div class="line">    .property(<span class="stringliteral">&quot;x&quot;</span>, &amp;Vec::x)</div>
<div class="line">    .property(<span class="stringliteral">&quot;y&quot;</span>, &amp;Vec::y)</div>
<div class="line">    .function(<span class="stringliteral">&quot;get&quot;</span>, &amp;Vec::get, policy::ReturnMultiple()) <span class="comment">// tuple to multiple policy</span></div>
<div class="line">    ;</div>
<div class="line"> </div>
<div class="line">ponder::lua::expose&lt;Vec&gt;(L, <span class="stringliteral">&quot;Vec2&quot;</span>);</div>
</div><!-- fragment --><p>From Lua: </p><pre class="fragment">t = Vec2(11,22)       -- create vector
x,y = t:get()         -- get scalars via multiple return values
</pre><h2><a class="anchor" id="lua_enums"></a>
Lua: Enum support</h2>
<p>The Lua state can be populate with registered enums now.</p>
<div class="fragment"><div class="line"><span class="keyword">enum class</span> Colour { Red, Green, Blue };</div>
</div><!-- fragment --><p>Declare:</p>
<div class="fragment"><div class="line">ponder::Enum::declare&lt;Colour&gt;()</div>
<div class="line">    .value(<span class="stringliteral">&quot;red&quot;</span>, Colour::Red)</div>
<div class="line">    .value(<span class="stringliteral">&quot;green&quot;</span>, Colour::Green)</div>
<div class="line">    .value(<span class="stringliteral">&quot;blue&quot;</span>, Colour::Blue)</div>
<div class="line">    ;</div>
<div class="line"> </div>
<div class="line">ponder::lua::expose&lt;Colour&gt;(L, <span class="stringliteral">&quot;Colour&quot;</span>);</div>
</div><!-- fragment --><p>From Lua: </p><pre class="fragment">assert(Colour.red == 0)
assert(Colour.green == 1)
assert(Colour.blue == 2)
</pre><h1><a class="anchor" id="ponder_2_2"></a>
2.2 Release Notes</h1>
<h2><a class="anchor" id="fmt_removed"></a>
fmt library removed</h2>
<p>In this release we removed the dependency on the <a href="https://github.com/fmtlib/fmt">fmt</a> print formatter library. Although this is an excellent library it causes problems if a Ponder client application is also using it. See issue <a href="https://github.com/billyquith/ponder/issues/59">#59</a>. We could work around these problems, but fmt was not used extensively so it is easier to remove it and deal with any performance issue directly. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<div class="ttc" id="anamespaceponder_html_a70733c0387bfaf658c5ded607c30d473"><div class="ttname"><a href="namespaceponder.html#a70733c0387bfaf658c5ded607c30d473">ponder::ValueKind</a></div><div class="ttdeci">ValueKind</div><div class="ttdoc">Enumeration of abstract value types supported by Ponder Values.</div><div class="ttdef"><b>Definition:</b> type.hpp:70</div></div>
<div class="ttc" id="anamespaceponder_html_a19b1bfb43a01f887ea5b9845f518cf63a86408593c34af77fdd90df932f8b5261"><div class="ttname"><a href="namespaceponder.html#a19b1bfb43a01f887ea5b9845f518cf63a86408593c34af77fdd90df932f8b5261">ponder::FunctionKind::Function</a></div><div class="ttdeci">@ Function</div><div class="ttdoc">a function</div></div>
<div class="ttc" id="anamespaceponder_html_a19b1bfb43a01f887ea5b9845f518cf63"><div class="ttname"><a href="namespaceponder.html#a19b1bfb43a01f887ea5b9845f518cf63">ponder::FunctionKind</a></div><div class="ttdeci">FunctionKind</div><div class="ttdoc">Enumeration of the kinds of function recognised.</div><div class="ttdef"><b>Definition:</b> type.hpp:103</div></div>
<div class="ttc" id="anamespaceponder_1_1runtime_html_a8524809118ea8407bc73e7cbc06fd358"><div class="ttname"><a href="namespaceponder_1_1runtime.html#a8524809118ea8407bc73e7cbc06fd358">ponder::runtime::call</a></div><div class="ttdeci">static Value call(const Function &amp;fn, const UserObject &amp;obj, A &amp;&amp;... args)</div><div class="ttdoc">Call a member function.</div><div class="ttdef"><b>Definition:</b> runtime.hpp:341</div></div>
<!-- HTML footer for doxygen 1.8.10-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="index.html">Ponder C++ library documentation</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.18 </li>
  </ul>
</div>
</body>
</html>
